name: 'Build'
description: 'Builds the Nav Mesh Project'
inputs:
  repo-path:
    description: 'Path to the plugin project source'
    required: true
runs:
  using: "composite"
  steps:
    - name: Checkout HL2SDK from Allied Modders
      uses: actions/checkout@v4
      with:
        repository: alliedmodders/hl2sdk
        ref: hl2dm
        path: hl2sdk

    - name: Configure CMake
      run: cmake -S "${{github.workspace}}/${{ inputs.repo-path }}" -B "${{github.workspace}}/build" -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}}
      env:
        BUILD_TYPE: Release
      shell: bash

    - name: Build
      env:
        BUILD_TYPE: Release
      run: cmake --build "${{github.workspace}}/build" --config ${{env.BUILD_TYPE}}
      shell: bash

    # --- CORRECTED ARTIFACT UPLOAD STEPS (with unique names) ---

    - name: Upload Linux Plugin Artifact
      if: runner.os == 'Linux'
      uses: actions/upload-artifact@v4
      with:
        # **CRITICAL CHANGE HERE:** Add ${{ github.run_id }} to make the name unique
        name: navmesh-plugin-linux-${{ github.run_id }}
        path: ${{github.workspace}}/build/test/libplugin_navmesh.so

    - name: Upload Windows Plugin Artifact
      if: runner.os == 'Windows'
      uses: actions/upload-artifact@v4
      with:
        # **CRITICAL CHANGE HERE:** Add ${{ github.run_id }} to make the name unique
        name: navmesh-plugin-windows-${{ github.run_id }}
        path: ${{github.workspace}}/build/test/Release/plugin_navmesh.dll

    # --- END CORRECTED ARTIFACT UPLOAD STEPS ---
